(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},4945:(t,e,a)=>{Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,5739))},5739:(t,e,a)=>{"use strict";a.d(e,{A:()=>d,GpsContextProvider:()=>i});var r=a(5155),o=a(3464),n=a(2115),c=a(9134);let l=(0,n.createContext)(),s=(t,e,a,r)=>{let o=t=>t*Math.PI/180,n=o(a-t),c=o(r-e),l=Math.sin(n/2)**2+Math.cos(o(t))*Math.cos(o(a))*Math.sin(c/2)**2;return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3},u=["202.80.228.44"];function i(t){let{children:e}=t,[a,i]=(0,n.useState)(null),[d,h]=(0,n.useState)(null),[m]=(0,n.useState)(!1),[g,f]=(0,n.useState)({status:"error",name:"คุณอยู่นอกพื้นที่"}),[v,P]=(0,n.useState)(!1),{locations:p}=function(){let[t,e]=(0,n.useState)([]),[a,r]=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{try{let t=(await c.A.get("/public/fetchGps")).data.data.map(t=>({id:t.stl_id,name:t.stl_name,lat:t.stl_lat,lon:t.stl_lon,radius:t.stl_radius,block:t.stl_block}));e(t)}catch(t){r("เกิดข้อผิดพลาดในการโหลดพิกัด"),console.error(t)}})()},[]),{locations:t,error:a}}(),b=(0,n.useRef)(null),A=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!navigator.geolocation){h("เบราว์เซอร์ของคุณไม่รองรับ GPS");return}let t=()=>/Mobi|Android|iPhone/i.test(navigator.userAgent),e=setTimeout(()=>{a||h("ไม่สามารถรับตำแหน่งจากอุปกรณ์ได้ภายในเวลาที่กำหนด")},1e4),r=a=>{clearTimeout(e);let r={lat:a.coords.latitude,lon:a.coords.longitude};if(console.log("\uD83D\uDCCD GPS Received:",r,"| Accuracy:",a.coords.accuracy),t()&&a.coords.accuracy>150){h("GPS ไม่แม่นยำพอ (".concat(Math.round(a.coords.accuracy)," เมตร)")),i(r);return}let o={lat:17.598248230864677,lon:103.97421612776841};if(!b.current&&s(r.lat,r.lon,o.lat,o.lon)>1e3){h("ตรวจพบว่าคุณเริ่มต้นจากตำแหน่งที่ไกลผิดปกติ"),i(r);return}let n=Date.now();if(b.current&&A.current){let t=s(b.current.lat,b.current.lon,r.lat,r.lon);if(t/((n-A.current)/1e3)>50){h("ตรวจพบความผิดปกติของตำแหน่ง GPS (เร็วเกินไป)"),i(r);return}}if(b.current=r,A.current=n,d&&h(null),i(r),!p||0===p.length)return;let c=p.find(t=>s(r.lat,r.lon,t.lat,t.lon)<=t.radius);c?c.block?f({status:"error",name:"ตำแหน่งของคุณถูกจำกัด (".concat(c.name,")")}):f({status:"success",name:"คุณอยู่ใน ".concat(c.name)}):f({status:"error",name:"คุณอยู่นอกพื้นที่ที่กำหนด"}),console.log("\uD83D\uDEF0️ GPS Still active:",r)},o=navigator.geolocation.watchPosition(r,t=>{clearTimeout(e),console.warn("⚠️ watchPosition error:",t.message),1===t.code?h("คุณปฏิเสธการเข้าถึงตำแหน่ง"):2===t.code?h("ไม่สามารถระบุตำแหน่งได้จากอุปกรณ์"):3===t.code?h("การขอตำแหน่งหมดเวลา กรุณาลองใหม่"):h("ข้อผิดพลาด : ".concat(t.message)),navigator.geolocation.getCurrentPosition(r,t=>{console.warn("❌ fallback ล้มเหลว:",t.message),h("".concat(t.message))},{enableHighAccuracy:!0,timeout:8e3,maximumAge:0})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return()=>{clearTimeout(e),navigator.geolocation.clearWatch(o)}},[p]),(0,n.useEffect)(()=>{S()},[]);let S=async()=>{try{let t=await o.A.get("https://api.ipify.org?format=json");P(u.includes(t.data.ip))}catch(t){console.error("IP fetch error:",t)}};return(0,r.jsx)(l.Provider,{value:{currentPosition:a,error:d,loading:m,locationStatus:g,isFromTrustedNetwork:v,allowedIps:u},children:e})}let d=l},9134:(t,e,a)=>{"use strict";a.d(e,{A:()=>o});var r=a(3464);r.A.defaults.baseURL="https://akathos.moph.go.th/api";let o=r.A}},t=>{var e=e=>t(t.s=e);t.O(0,[690,464,441,684,358],()=>e(4945)),_N_E=t.O()}]);