(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[434],{3966:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(2115),o=a(5739);function n(){return(0,r.useContext)(o.A)}},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},5739:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,GpsContextProvider:()=>u});var r=a(5155),o=a(3464),n=a(2115),l=a(9134);let s=(0,n.createContext)(),c=(e,t,a,r)=>{let o=e=>e*Math.PI/180,n=o(a-e),l=o(r-t),s=Math.sin(n/2)**2+Math.cos(o(e))*Math.cos(o(a))*Math.sin(l/2)**2;return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3},i=["202.80.228.44"];function u(e){let{children:t}=e,[a,u]=(0,n.useState)(null),[d,m]=(0,n.useState)(null),[f]=(0,n.useState)(!1),[h,x]=(0,n.useState)({status:"error",name:"คุณอยู่นอกพื้นที่"}),[g,p]=(0,n.useState)(!1),{locations:v}=function(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{try{let e=(await l.A.get("/public/fetchGps")).data.data.map(e=>({id:e.stl_id,name:e.stl_name,lat:e.stl_lat,lon:e.stl_lon,radius:e.stl_radius,block:e.stl_block}));t(e)}catch(e){r("เกิดข้อผิดพลาดในการโหลดพิกัด"),console.error(e)}})()},[]),{locations:e,error:a}}(),b=(0,n.useRef)(null),w=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!navigator.geolocation){m("เบราว์เซอร์ของคุณไม่รองรับ GPS");return}let e=()=>/Mobi|Android|iPhone/i.test(navigator.userAgent),t=setTimeout(()=>{a||m("ไม่สามารถรับตำแหน่งจากอุปกรณ์ได้ภายในเวลาที่กำหนด")},1e4),r=a=>{clearTimeout(t);let r={lat:a.coords.latitude,lon:a.coords.longitude};if(console.log("\uD83D\uDCCD GPS Received:",r,"| Accuracy:",a.coords.accuracy),e()&&a.coords.accuracy>150){m("GPS ไม่แม่นยำพอ (".concat(Math.round(a.coords.accuracy)," เมตร)")),u(r);return}let o={lat:17.598248230864677,lon:103.97421612776841};if(!b.current&&c(r.lat,r.lon,o.lat,o.lon)>1e3){m("ตรวจพบว่าคุณเริ่มต้นจากตำแหน่งที่ไกลผิดปกติ"),u(r);return}let n=Date.now();if(b.current&&w.current){let e=c(b.current.lat,b.current.lon,r.lat,r.lon);if(e/((n-w.current)/1e3)>50){m("ตรวจพบความผิดปกติของตำแหน่ง GPS (เร็วเกินไป)"),u(r);return}}if(b.current=r,w.current=n,d&&m(null),u(r),!v||0===v.length)return;let l=v.find(e=>c(r.lat,r.lon,e.lat,e.lon)<=e.radius);l?l.block?x({status:"error",name:"ตำแหน่งของคุณถูกจำกัด (".concat(l.name,")")}):x({status:"success",name:"คุณอยู่ใน ".concat(l.name)}):x({status:"error",name:"คุณอยู่นอกพื้นที่ที่กำหนด"}),console.log("\uD83D\uDEF0️ GPS Still active:",r)},o=navigator.geolocation.watchPosition(r,e=>{clearTimeout(t),console.warn("⚠️ watchPosition error:",e.message),1===e.code?m("คุณปฏิเสธการเข้าถึงตำแหน่ง"):2===e.code?m("ไม่สามารถระบุตำแหน่งได้จากอุปกรณ์"):3===e.code?m("การขอตำแหน่งหมดเวลา กรุณาลองใหม่"):m("ข้อผิดพลาด : ".concat(e.message)),navigator.geolocation.getCurrentPosition(r,e=>{console.warn("❌ fallback ล้มเหลว:",e.message),m("".concat(e.message))},{enableHighAccuracy:!0,timeout:8e3,maximumAge:0})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return()=>{clearTimeout(t),navigator.geolocation.clearWatch(o)}},[v]),(0,n.useEffect)(()=>{S()},[]);let S=async()=>{try{let e=await o.A.get("https://api.ipify.org?format=json");p(i.includes(e.data.ip))}catch(e){console.error("IP fetch error:",e)}};return(0,r.jsx)(s.Provider,{value:{currentPosition:a,error:d,loading:f,locationStatus:h,isFromTrustedNetwork:g,allowedIps:i},children:t})}let d=s},7862:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(5155),o=a(2115),n=a(5695),l=a(9134),s=a(4752),c=a.n(s),i=a(1184),u=a(9365),d=a(9951);function m(){let[e,t]=(0,o.useState)(29),[a,s]=(0,o.useState)(""),[m,f]=(0,o.useState)(!1),h=(0,n.useRouter)(),[x,g]=(0,o.useState)(!1),p=(0,o.useRef)(null),[v,b]=(0,o.useState)(void 0),[w,S]=(0,o.useState)("");(0,o.useEffect)(()=>{let e=localStorage.getItem("fullname");e&&S(e)}),(0,o.useEffect)(()=>{let e=localStorage.getItem("tokencheck");b(e),e||c().fire({title:"ไม่พบข้อมูล",text:"กรุณาลงชื่อเข้าใช้งาน",icon:"warning",confirmButtonText:"ตกลง"}).then(()=>{h.push("/")})},[]),(0,o.useEffect)(()=>{p.current&&p.current.focus()},[]),(0,o.useEffect)(()=>{if(e>0){let e=setInterval(()=>{t(e=>e-1)},1e3);return()=>clearInterval(e)}f(!0),g(!1)},[e]),(0,o.useEffect)(()=>{0===e&&(j(),localStorage.removeItem(w),localStorage.removeItem("otpCode"),localStorage.removeItem("tokencheck"),localStorage.removeItem("national_id"),localStorage.removeItem("shift_type_id"),localStorage.removeItem("fullname"),h.push("/"))},[e]),(0,o.useEffect)(()=>{6===a.length&&j()},[e]);let j=async()=>{localStorage.setItem("otpCode",a);try{let e=localStorage.getItem("tokencheck"),t=localStorage.getItem("otpCode"),a=localStorage.getItem("fullname"),r=localStorage.getItem("formattedTime"),o=await l.A.post("/public/checkInVerifyOtp",{otpCode:t},{headers:{Authorization:"Bearer ".concat(e)},"Content-Type":"application/json"});200===o.status&&c().fire({title:"ยืนยันการเข้างาน",text:"ชื่อ : ".concat(a," เวลาทำงานของคุณคือ ").concat(r," น. ,ตั้งใจทำงานเด้อ!"),icon:"success",confirmButtonText:"ตกลง",customClass:{popup:"custom-popup",confirmButton:"custom-button"},confirmButtonColor:"#4DC247"}).then(()=>{localStorage.removeItem("tokencheck"),localStorage.removeItem("national_id"),localStorage.removeItem("otpCode"),localStorage.removeItem("shift_type_id"),localStorage.removeItem("fullname"),localStorage.removeItem("formattedTime"),h.push("/")})}catch(r){var e,t;let a=(null==r?void 0:null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"เกิดข้อผิดพลาดในการยืนยัน OTP";"TokenExpiredError!"===a?c().fire({title:"หมดเวลาการกรอกรหัสยืนยัน",text:"กรุณาลองใหม่อีกครัง",icon:"error",confirmButtonText:"ตกลง",willClose:()=>{N()}}):c().fire({title:a,icon:"error",confirmButtonText:"ตกลง",willClose:()=>{N()}})}},k=async()=>{let e=localStorage.getItem("national_id"),a=localStorage.getItem("shift_type_id"),r=localStorage.getItem("tokencheck"),o={national_id:e,shift_type_id:Number(a)};try{let e=await l.A.post("/public/checkIn",o,{headers:{Authorization:"Bearer ".concat(r)}});200===e.status&&(localStorage.setItem("tokencheck",e.data.token),t(29),g(!0))}catch(e){c().fire({title:"รหัสยืนยันหมดอายุ",text:"กรุณาขอรหัสยืนยัน OTP ใหม่อีกครั้ง",icon:"question",confirmButtonText:"ตกลง"}).then(()=>{N()})}},y=async()=>{try{let e=localStorage.getItem("tokencheck");await l.A.post("/public/checkInVerifyOtp",{otpCode:"123456"},{headers:{Authorization:"Bearer ".concat(e)},"Content-Type":"application/json"})}catch(a){var e,t;(null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)==="TokenExpiredError!"&&(setTimeout(()=>{k()},500),c().fire({title:"ส่งรหัสยืนยันสำเร็จ",text:"กรุณาตรวจสอบ OTP ในช่องทางที่ได้รับ",icon:"info",confirmButtonText:"ตกลง",willClose:()=>{N()}}))}},N=()=>{s("")};return(0,o.useEffect)(()=>{window.history.pushState(null,null,window.location.href),window.onpopstate=function(){window.history.pushState(null,null,window.location.href)};let e=e=>{if(!a||a.length<6){let t="คุณยังไม่ได้กรอกรหัส OTP ต้องการออกจากหน้านี้หรือไม่?";return e.returnValue=t,t}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[a]),(0,o.useEffect)(()=>{y()},[]),(0,r.jsx)(d.A,{children:(0,r.jsx)("div",{className:"w-full h-screen grid place-items-center bg-green-700",children:(0,r.jsxs)("div",{className:"bg-white  rounded-sm px-8 pt-4 pr-3 pl-4 pb-8  mt-4  ",children:[(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("div",{className:"text-red-500",children:["⚠️ อย่าออกจากหน้านี้ ขณะดำเนินการ ⚠️"," ",(0,r.jsx)("div",{children:" ระบบอาจไม่บันทึกข้อมูล "})]})}),(0,r.jsx)("p",{className:"select-none text-2xl font-bold text-black text-center mt-4 ",children:"\uD83D\uDD12 ยืนยัน OTP"}),(0,r.jsx)("img",{className:"w-37 mx-auto rounded-full ",src:"/check/docs/otpphon.png",alt:"imageverify"}),(0,r.jsxs)("p",{className:"text-center text-lg font-semibold text-black mt-1",children:["ชื่อ: ",w]}),(0,r.jsx)("p",{className:"text-center text-base text-gray-600 mt-2",children:0!==e?"เหลือเวลา ".concat(e):"เวลาหมดกรุณาขอรหัส OTP ใหม่"}),(0,r.jsx)("div",{className:"text-black mt-2",children:(0,r.jsx)(u.UV,{maxLength:6,pattern:i.UO,value:a,onChange:e=>s(e),children:(0,r.jsx)(u.NV,{className:"space-x-2",children:[...Array(6)].map((e,t)=>(0,r.jsx)(u.sF,{index:t,ref:0===t?p:void 0,inputMode:"numeric",pattern:"\\d*",className:"bg-zinc-300 inset-shadow-sm text-2xl h-14 w-12 rounded-sm border-l border-accent shadow-none font-semibold"},t))})})})]})})})}},9134:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(3464);r.A.defaults.baseURL="https://akathos.moph.go.th/api";let o=r.A},9365:(e,t,a)=>{"use strict";a.d(t,{UV:()=>i,NV:()=>u,sF:()=>d});var r=a(5155),o=a(2115),n=a(1184),l=a(2596),s=a(9688);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,l.$)(t))}function i(e){let{className:t,containerClassName:a,...o}=e;return(0,r.jsx)(n.wE,{"data-slot":"input-otp",containerClassName:c("flex items-center gap-5 has-disabled:opacity-50 ",a),className:c("disabled:cursor-not-allowed",t),...o})}function u(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"input-otp-group",className:c("flex items-center mt-2",t),...a})}function d(e){var t;let{index:a,className:l,...s}=e,i=o.useContext(n.dK),{char:u,hasFakeCaret:d,isActive:m}=null!==(t=null==i?void 0:i.slots[a])&&void 0!==t?t:{};return(0,r.jsxs)("div",{"data-slot":"input-otp-slot","data-active":m,className:c("data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",l),...s,children:[u,d&&(0,r.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-caret-blink bg-foreground h-4 w-px duration-1000 "})})]})}},9629:(e,t,a)=>{Promise.resolve().then(a.bind(a,7862))},9951:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(5155),o=a(2115),n=a(3966);function l(e){let{children:t}=e,{loading:a,error:l}=(0,n.A)(),[s,c]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{c(!0)},[]),!s||a)?(0,r.jsxs)("div",{role:"status",className:"absolute inset-0 flex items-center justify-center bg-[#0b8d66] flex-col",children:[(0,r.jsx)("img",{src:"/check/docs/loadingfish.gif",alt:"กำลังโหลด...",className:" h-auto w-auto"}),(0,r.jsx)("p",{className:"text-white text-lg sm:text-xl font-semibold animate-pulse",children:"กำลังโหลดข้อมูล..."})]}):"User denied Geolocation"===l?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-red-900",children:(0,r.jsxs)("div",{className:" text-white text-center p-6 rounded-xl shadow-xl max-w-xl mx-auto ",children:[(0,r.jsx)("p",{className:"mt-4 text-2xl text-red-300 italic ",children:"* แจ้งเตือน *"}),(0,r.jsxs)("div",{className:"mt-3 ",children:[(0,r.jsx)("h1",{className:"text-xl font-bold mb-4",children:"\uD83D\uDEAB ไม่อนุญาตให้ใช้ตำแหน่ง \uD83D\uDEAB"}),(0,r.jsxs)("p",{className:"text-xl",children:["ระบบจำเป็นต้องใช้การระบุตำแหน่งเพื่อเข้าถึงระบบ ",(0,r.jsx)("br",{}),"โปรดอนุญาตให้เข้าถึงตำแหน่งของคุณ"]})]})]})}):(0,r.jsx)(r.Fragment,{children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[320,464,484,441,684,358],()=>t(9629)),_N_E=e.O()}]);